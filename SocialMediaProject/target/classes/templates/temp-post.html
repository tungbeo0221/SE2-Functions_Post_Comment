<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Posts and Comments</title>
    <link th:href="@{/style/Post.css}"/>
    <style>
        body {
            background-color: #EAEAEA;
            font-family: "Outfit", sans-serif;
            font-style: normal;
            font-size: 24px;
            font-weight: 400;
            align-items: center;
            justify-content: center;
            display: flex;
        }

        /* Styles for the container div */
        #container {
            display: flex;
            flex-direction: column;
            align-items: center;
            border-radius: 8px;
            background-color: white;
            padding: 15px;
            gap: 10px;
            width: 800px; /* Adjust container width as needed */
            /* 1. Adjust container width */
            /* 1. Container width updated */
            position: relative;
        }

        /* Styles for the post and comments container */
        .post-container {
            width: 100%;
            /* 1. Adjust container width */
        }

        /* Styles for the post div */
        .post {
            margin-bottom: 20px; /* Add spacing between posts */
        }

        /* Styles for the username div */
        .username {
            font-weight: bold;
            margin-bottom: 10px;
            /* 2. Username displayed on top, left side */
        }

        /* Styles for the post content */
        .post-content {
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
            /* 4. Display line below post */
            /* 5. Add spacing below post */
        }

         /* Styles for the line below the post */
        .post-line {
            border-bottom: 1px solid #ccc;
            width: 100%; /* Adjust line width to match container */
            margin-bottom: 10px; /* Add spacing below the line */
        }

        /* Styles for the comment section */
        .comment-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-left: 20px;
            margin-right: 20px;
        }
         /* Styles for the comment input and button and profile picture container */
         .input-button-container {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 10px;
            width: 100%;
         }

         /* Styles for the profile picture */
        .profile-picture {
            width: 50px; /* Adjust the width of the profile picture */
            height: 50px; /* Adjust the height of the profile picture */
            background-color: #ccc; /* Sample background color */
           /* Add margin to create space between profile picture and text area */
}

        /* Styles for the comment input */
        .comment-input {
            width: calc(60% - 40px); /* Adjust width based on button size */
            height: 60px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            resize: none;
            flex-grow: 1;
            /* 5. Text area for typing */
        }

        /* Styles for the comment button */
        .comment-button {
            width: 55px; /* Adjust button width */
            height: 40px; /* Adjust button height */
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            /* 6. Square button */
        }

        /* Styles for comment and username and profile picture container */
        .comment-content-container {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 10px;
            width: 100%;
            margin-left: 30px;
        }

        /* Additional styles for comments */
        .comment {
            flex: 1;
            background-color: #f2f2f2;
            font-size: 18px;
            margin-bottom: 10px;
            width: fit-content;
            position: relative;
            word-wrap: break-word;
            border: 1px solid #ccc;
            padding: 8px;
            border-radius: 8px;
            /* 7. Comment styling */
        }

        /* Additional styles for username in comments */
        .comment-username {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 16px;
            font-weight: 500px;
            /* 8. Username above each comment */
        }

        /* Additional styles for container of comment area and option buttons*/
        .comment-option-container{
            display: flex;
            align-items: center;

        }

        .more-options-button {
            display: flex;
            position: static;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;

        }

        .more-options {
            display: flex;
            flex-direction: column;
            gap: 5px; /* Add spacing between update and delete buttons */
        }

        .update-button, .delete-button {

            width: 100%;
            padding: 5px 10px;
            border: 1px solid #f2f2f2;
            border-radius: 8px;
            background-color: #f2f2f2;
            cursor: pointer;
            margin: 4px;
        }

        .updated-comment-input {

            width: calc(100% - 40px); /* Adjust width based on button size */
            height: 60px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            resize: none;
            flex-grow: 1;
            margin-right: 10px; /* Add margin between textarea and button */
        }
    </style>
</head>
<body>
<div id="container">
    <!-- Iterating over posts -->
    <div th:each="post : ${posts}" class="post-container">
        <div class="post">
            <!-- Username -->
            <div class="username" th:text="${post.user.username}"> username1</div>
            <!-- Post content -->
            <div class="post-content" th:text="${post.status}">post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1post 1</div>
            <!-- Line below the post -->
            <div class="post-line"></div>
            <!-- Comment section -->
            <div class="comment-section">
                <div class="input-button-container" >
                    <!-- Profile picture -->
                    <div class="profile-picture"></div>
                    <!-- Text area for typing -->
                    <textarea class="comment-input" placeholder="Comment..."></textarea>
                    <!-- Button to upload comment -->
                    <button class="comment-button"
                        th:onclick=" 'createComment(\'' + ${post.postId} + '\')' "
                    >Post</button>
                </div>
                    <!-- Iterating over comments for each post -->
                <div class="comment-content-container">
                    <!-- Profile picture -->
                    <div class="profile-picture"></div>
                    <div>
                        <!-- Username of user who commented -->
                        <div class="comment-username" th:text="${comment.user.username}">username2</div>
                        <!-- Container of comment area and option button -->
                        <div class="comment-option-container">
                            <div th:each="comment : ${post.comments}" class="comment">
                                <!-- Comment content -->
                                <div th:text="${comment.content}">hehe</div>
                            </div>
                            <!-- More options buttons -->
                            <div>
                            <button class="more-options-button">&#8942;</button>
                            <div class="more-options">
                                <!-- Update and delete buttons -->
                                    <!-- Textarea for updated comment -->
                                    <textarea class="updated-comment-input"
                                              placeholder="Type your updated comment here..."></textarea>
                                    <!-- Button to update comment -->
                                    <button class="update-button"
                                            onclick="updateComment(${post.postId}, ${comment.commentId})"
                                            >Update</button>
                                    <!-- Delete -->
                                    <button class="delete-button"
                                            th:onclick=" 'deleteComment(\''+${post.postId}+ '\', \''+${comment.commentId}+'\' ' "
                                    >Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function createComment(postId){
    var commentText = document.querySelector('.comment-input').value;
    var data = {
        content: commentText
    }
    fetch('/api/posts' + postId + '/comments', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => {
        if(!response.ok){
            throw new Error('Failed to post comment');
        }
        alert('Comment posted successfully');
        //reload or update the comment section
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Failed to post comment');
    });
    }

    document.querySelectorAll('.more-options-button').forEach(button => {
    button.addEventListener('click', () => {
        console.log('Button clicked');
        const moreOptions = button.nextElementSibling;
        moreOptions.style.display = moreOptions.style.display === 'none' ? 'block' : 'none';
    });
});

    function updateComment(postId, commentId){
        var updatedContent = document.querySelector(`#comment-${commentId} .updated-comment-input`).value

        var data ={
            content: updatedContent
        }
        fetch(`/api/posts/${postId}/comments/${commentId}}`,{
            method: 'PUT',
            headers: {
                'Content-Type':'application/json'
            },
            body:JSON.stringify(updatedComment)
        })
        .then(response => {
            if(!response.ok){
            throw new Error('Failed to update comment')
            }
            alert('Comment updated successfully');
            })
            .catch(error =>{
                console.error('Error: ', error);
                alert('Failed to update comment')
            });
    }

    function deleteComment(postId, commentId){
        fetch(`/api/posts/${postId}/comments/${commentId}`, {
            method: 'DELETE'
        })
        .then(response => {
            if(!response.ok){
                throw new Error('Failed to delete comment');
            }
            alert('Comment deleted successfully');
            // Reload or update the comment section
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to delete comment');
        });
    }

</script>
</body>
</html>


